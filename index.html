// --- VERBETERDE BESTURING ---

function setupCanvas() {
    canvas = document.getElementById('gameCanvas'); 
    ctx = canvas.getContext('2d');
    const s = Math.min(window.innerWidth * 0.95, 400); 
    tileSize = Math.floor(s/19);
    canvas.width = tileSize * 19; 
    canvas.height = tileSize * 11;

    // 1. TOUCHBESTURING (SWIPE)
    let touchX = 0;
    let touchY = 0;

    canvas.addEventListener('touchstart', e => {
        touchX = e.touches[0].clientX;
        touchY = e.touches[0].clientY;
        e.preventDefault();
    }, { passive: false });

    canvas.addEventListener('touchend', e => {
        let diffX = e.changedTouches[0].clientX - touchX;
        let diffY = e.changedTouches[0].clientY - touchY;

        if (Math.abs(diffX) > Math.abs(diffY)) {
            // Horizontaal
            pacman.nextDir = diffX > 0 ? {x:1, y:0} : {x:-1, y:0};
        } else {
            // Verticaal
            pacman.nextDir = diffY > 0 ? {x:0, y:1} : {x:0, y:-1};
        }
        e.preventDefault();
    }, { passive: false });

    // 2. TOETSENBORD BESTURING (PIJLTJES)
    window.addEventListener('keydown', e => {
        // Voorkom scrollen met pijltjes
        if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].indexOf(e.code) > -1) {
            e.preventDefault();
        }

        switch(e.key) {
            case "ArrowUp":    case "Up":    pacman.nextDir = {x:0, y:-1}; break;
            case "ArrowDown":  case "Down":  pacman.nextDir = {x:0, y:1};  break;
            case "ArrowLeft":  case "Left":  pacman.nextDir = {x:-1, y:0}; break;
            case "ArrowRight": case "Right": pacman.nextDir = {x:1, y:0};  break;
        }
    });
}
