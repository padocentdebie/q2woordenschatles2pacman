<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BTV Pac-Man: Hybrid Edition</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root { --btv: #003159; --geel: #f0db4f; --blauw: #2121ff; }
        body { font-family: 'Courier New', Courier, monospace; background: #000; color: #fff; margin: 0; overflow: hidden; touch-action: none; }
        #stage { width: 100vw; height: 100vh; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        canvas { border: 4px solid var(--blauw); background: #000; box-shadow: 0 0 20px var(--blauw); max-width: 95vw; max-height: 70vh; }
        
        #quiz-box { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 90%; max-width: 450px; background: rgba(0,0,0,0.95); border: 3px solid var(--geel); border-radius: 15px; padding: 25px; text-align: center; z-index: 100; box-shadow: 0 0 30px rgba(240, 219, 79, 0.3); }
        .optie { display: block; width: 100%; padding: 15px; margin: 12px 0; border: 2px solid var(--btv); border-radius: 10px; background: #111; color: #fff; font-size: 1.1rem; cursor: pointer; transition: 0.2s; }
        .optie:hover { background: var(--btv); border-color: var(--geel); }
        
        .hud { display: flex; gap: 30px; font-weight: bold; color: var(--geel); padding: 15px; font-size: 1.2rem; text-shadow: 2px 2px #000; }
        #login-screen { text-align: center; border: 2px solid var(--geel); padding: 40px; border-radius: 20px; }
        input { padding: 15px; border-radius: 8px; border: none; width: 220px; margin-bottom: 15px; font-size: 1rem; }
        button#start-btn { padding: 15px 35px; background: var(--geel); border: none; font-weight: bold; cursor: pointer; border-radius: 8px; font-size: 1.1rem; }
        #control-hint { margin-top: 10px; color: #666; font-size: 0.9rem; }
    </style>
</head>
<body>

<div id="stage">
    <div id="login-screen">
        <h1 style="color: var(--geel); font-size: 2.5rem; margin-top: 0;">BTV PAC-MAN</h1>
        <input type="text" id="vnaam" placeholder="Je Voornaam...">
        <br>
        <button id="start-btn" onclick="initSessie()">START MISSIE</button>
        <p id="control-hint">Gebruik ‚å®Ô∏è Pijltjes of üì± Swipe</p>
    </div>

    <div id="quiz-box" style="display:none;">
        <h3 id="q-status" style="color: var(--geel); margin-top: 0;">DATA RECOVERY</h3>
        <h2 id="vraag">...</h2>
        <div id="optie-container"></div>
    </div>

    <div id="game-container" style="display:none;">
        <div class="hud">
            <span>LEVEL: <span id="lvl-val">1</span></span>
            <span>SCORE: <span id="scr-val">0</span></span>
            <span>LIVES: <span id="lvn-val">3</span></span>
        </div>
        <canvas id="gameCanvas" width="400" height="400"></canvas>
    </div>
</div>

<script>
    const firebaseConfig = {
        apiKey: "AIzaSyBEod8zm1jvvkmPbe6cA_SQo2U_esC9yTY",
        databaseURL: "https://aangiftebotje-default-rtdb.europe-west1.firebasedatabase.app",
        projectId: "aangiftebotje"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    const DATABASE = [
        { v: "Wat is 'Recidive'?", o: ["Herhaling strafbaar feit", "Vrijspraak", "Nieuw bewijs"], c: 0 },
        { v: "Wat is 'Proportioneel'?", o: ["Altijd maximaal", "In verhouding", "Willekeurig"], c: 1 },
        { v: "Consistent verklaren?", o: ["Zonder tegenspraak", "Heel erg luid", "Met veel emotie"], c: 0 },
        { v: "Wat betekent 'Seponeren'?", o: ["Zaak stoppen", "Hoger beroep", "Directe boete"], c: 0 },
        { v: "De 'Cautie' is...", o: ["Het zwijgrecht", "De arrestatie", "Het proces-verbaal"], c: 0 },
        { v: "Wat is 'Jurisdictie'?", o: ["Rechtsgebied", "Wetboek", "Advocatuur"], c: 0 },
        { v: "Een 'Delict' is een...", o: ["Strafbaar feit", "Getuige", "Veroordeling"], c: 0 },
        { v: "Wat is 'Hechtenis'?", o: ["Vrijheidsbeneming", "Geldboete", "Vrijspraak"], c: 0 },
        { v: "Mandateren betekent...", o: ["Bevoegdheid geven", "Ontslag nemen", "Iemand schorsen"], c: 0 },
        { v: "Wat is 'Opportuniteit'?", o: ["Besluit tot vervolging", "Type bewijs", "Een getuigenis"], c: 0 }
    ];

    let sRef, vnaam, score = 0, levens = 3, level = 1, frame = 0;
    let pX, pY, pDir = {x:0, y:0};
    let dots = [], walls = [], ghost = {x:0, y:0};
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');

    function initSessie() {
        vnaam = document.getElementById('vnaam').value;
        if(!vnaam) return alert("Voer je naam in!");
        sRef = db.ref('ranking').push({ naam: vnaam, score: 0 });
        document.getElementById('login-screen').style.display = 'none';
        startQuiz();
    }

    function startQuiz() {
        document.getElementById('quiz-box').style.display = 'block';
        const q = DATABASE[Math.floor(Math.random()*DATABASE.length)];
        document.getElementById('vraag').innerText = q.v;
        const box = document.getElementById('optie-container'); box.innerHTML = '';
        q.o.forEach((t, i) => {
            const b = document.createElement('button'); b.className = 'optie'; b.innerText = t;
            b.onclick = () => { if(i==q.c) launchGame(); else alert("Onjuist! Probeer opnieuw."); };
            box.appendChild(b);
        });
    }

    function launchGame() {
        document.getElementById('quiz-box').style.display = 'none';
        document.getElementById('game-container').style.display = 'block';
        initLevel();
    }

    function initLevel() {
        dots = []; 
        pX = 200; pY = 320; pDir = {x:0, y:0};
        ghost = {x:200, y:80};
        
        // --- 3 Levels Doolhof ---
        if(level == 1) walls = [{x:60, y:60, w:280, h:20}, {x:60, y:280, w:280, h:20}];
        else if(level == 2) walls = [{x:40, y:40, w:20, h:320}, {x:340, y:40, w:20, h:320}, {x:120, y:200, w:160, h:20}];
        else walls = [{x:0, y:190, w:140, h:20}, {x:260, y:190, w:140, h:20}, {x:190, y:0, w:20, h:140}, {x:190, y:260, w:20, h:140}];

        for(let i=40; i<380; i+=40) for(let j=40; j<380; j+=40) {
            if(!walls.some(w => i > w.x-15 && i < w.x+w.w+15 && j > w.y-15 && j < w.y+w.h+15)) dots.push({x:i, y:j, e:false});
        }
        document.getElementById('lvl-val').innerText = level;
        requestAnimationFrame(draw);
    }

    function draw() {
        if(document.getElementById('game-container').style.display === 'none') return;
        frame++;
        ctx.fillStyle = 'black'; ctx.fillRect(0,0,400,400);

        // Muren & Punten
        ctx.fillStyle = '#2121ff'; walls.forEach(w => {
            ctx.fillRect(w.x, w.y, w.w, w.h);
            ctx.strokeStyle = "white"; ctx.strokeRect(w.x, w.y, w.w, w.h);
        });
        
        ctx.fillStyle = '#ffb8ae'; dots.forEach(d => {
            if(!d.e) {
                ctx.beginPath(); ctx.arc(d.x, d.y, 3, 0, 7); ctx.fill();
                if(Math.hypot(pX-d.x, pY-d.y) < 18) { d.e = true; score += 10; document.getElementById('scr-val').innerText = score; sRef.update({score:score}); }
            }
        });

        // Beweging Logica
        let speed = 3;
        let nX = pX + pDir.x * speed;
        let nY = pY + pDir.y * speed;
        
        if(!walls.some(w => nX > w.x-15 && nX < w.x+w.w+15 && nY > w.y-15 && nY < w.y+w.h+15)) {
            pX = Math.max(15, Math.min(385, nX));
            pY = Math.max(15, Math.min(385, nY));
        }

        // Pacman Animatie
        ctx.fillStyle = 'yellow'; ctx.beginPath();
        let angle = (pDir.x > 0) ? 0 : (pDir.x < 0) ? Math.PI : (pDir.y < 0) ? 1.5*Math.PI : 0.5*Math.PI;
        let mouth = Math.abs(Math.sin(frame/4)*0.3);
        ctx.arc(pX, pY, 14, angle + mouth, angle + 2*Math.PI - mouth);
        ctx.lineTo(pX, pY); ctx.fill();

        // Ghost AI
        ghost.x += (pX > ghost.x ? 1 : -1) * (0.9 + level*0.3);
        ghost.y += (pY > ghost.y ? 1 : -1) * (0.9 + level*0.3);
        ctx.fillStyle = 'red'; ctx.font = "20px Arial"; ctx.fillText("üëª", ghost.x-10, ghost.y+8);

        // Game Over & Win
        if(Math.hypot(pX-ghost.x, pY-ghost.y) < 22) {
            levens--; document.getElementById('lvn-val').innerText = levens;
            if(levens <= 0) { alert("GAME OVER! Je score: " + score); location.reload(); } else { startQuiz(); }
            return;
        }

        if(dots.every(d => d.e)) { level++; alert("LEVEL COMPLETE!"); initLevel(); return; }
        requestAnimationFrame(draw);
    }

    // --- INPUT: KEYBOARD ---
    window.addEventListener('keydown', (e) => {
        if(e.key == "ArrowLeft") pDir = {x:-1, y:0};
        else if(e.key == "ArrowRight") pDir = {x:1, y:0};
        else if(e.key == "ArrowUp") pDir = {x:0, y:-1};
        else if(e.key == "ArrowDown") pDir = {x:0, y:1};
    });

    // --- INPUT: TOUCH/SWIPE ---
    let tS = null;
    window.addEventListener('touchstart', e => tS = {x: e.touches[0].clientX, y: e.touches[0].clientY});
    window.addEventListener('touchend', e => {
        if(!tS) return;
        let dx = e.changedTouches[0].clientX - tS.x, dy = e.changedTouches[0].clientY - tS.y;
        if(Math.abs(dx) > Math.abs(dy)) pDir = {x: dx > 0 ? 1 : -1, y: 0};
        else pDir = {x: 0, y: dy > 0 ? 1 : -1};
    });
</script>
</body>
</html>
