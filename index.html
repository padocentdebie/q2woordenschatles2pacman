<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>BTV Police Training - Pac-Man Edition</title>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root { --cobalt: #0044ff; --gold: #f0db4f; --danger: #ff0000; --success: #2ecc71; --bg: #000; }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: #eee; margin: 0; display: flex; flex-direction: column; align-items: center; touch-action: none; overflow: hidden; }
        .hud { width: 100%; max-width: 450px; padding: 15px; display: flex; justify-content: space-between; font-weight: bold; color: var(--gold); background: #111; border-bottom: 4px solid var(--cobalt); box-sizing: border-box; }
        #timer-display { color: #fff; font-size: 1rem; font-weight: bold; padding: 10px; text-align: center; width: 100%; background: #222; min-height: 1.2rem; }
        #game-container { position: relative; border: 6px solid #111; background: #000; }
        canvas { display: block; background: #000; }
        #quiz-box { 
            position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); 
            width: 90%; background: #fff; border-radius: 8px; padding: 20px; 
            text-align: center; display: none; z-index: 100; color: #000; box-sizing: border-box;
            border: 5px solid var(--cobalt); box-shadow: 0 0 50px rgba(0,0,0,0.9);
        }
        .optie { display: block; width: 100%; padding: 12px; margin: 8px 0; background: #eee; border: 2px solid #ccc; cursor: pointer; border-radius: 6px; font-weight: bold; color: #000; font-size: 0.9rem; }
        .correct { background: var(--success) !important; color: #fff; border-color: #1e8449; }
        .fout { background: var(--danger) !important; color: #fff; border-color: #922b21; }
        .progress-text { font-size: 0.8rem; color: #666; margin-top: 5px; font-weight: bold; }
        .panel { width: 95%; max-width: 430px; margin-top: 10px; background: #111; padding: 10px; border: 1px solid #333; }
        .btn { background: var(--cobalt); color: white; padding: 12px; width: 100%; border: none; font-weight: bold; cursor: pointer; border-radius: 4px; text-transform: uppercase; }
        .score-row { display: flex; justify-content: space-between; padding: 4px; font-family: monospace; font-size: 0.9rem; border-bottom: 1px solid #222; }
    </style>
</head>
<body>

<div id="login" style="margin-top: 50px; text-align: center;">
    <h1 style="color: var(--gold); letter-spacing: 2px;">BTV PAC-MAN</h1>
    <input type="text" id="vnaam" placeholder="AGENT NAAM..." style="padding:15px; width:220px; border-radius:5px; text-align:center;"><br><br>
    <button class="btn" style="width:250px;" onclick="initSessie()">START TRAINING</button>
</div>

<div id="main-game" style="display:none;">
    <div class="hud"><span>SCORE: <span id="scr-val">0</span></span><span>HP: <span id="lvn-val">5</span></span></div>
    <div id="timer-display">SYSTEEM GEREED</div>
    <div id="game-container">
        <canvas id="gameCanvas"></canvas>
        <div id="quiz-box">
            <div id="vraag" style="font-size:1.1rem; font-weight:800; margin-bottom:15px; text-transform: uppercase;"></div>
            <div id="optie-container"></div>
            <div class="progress-text" id="prog-val">Voortgang: 0 / 5</div>
            <button id="btn-volgende" class="btn" style="display:none; background:var(--danger); margin-top:10px;" onclick="nextQ()">FOUT: RESET NAAR 0</button>
            <button id="restart-btn" style="display:none;" class="btn" onclick="location.reload()">HERSTART TRAINING</button>
        </div>
    </div>
    <div class="panel"><h3>TOP SCORES</h3><div id="score-list">Laden...</div></div>
    <div class="panel">
        <textarea id="bulk-text" style="width:100%; height:50px; background:#000; color:#0f0; border:1px solid #333; margin-bottom:5px;" placeholder="woord betekenis (per regel)"></textarea>
        <button class="btn" style="font-size:0.7rem;" onclick="bulkAddWords()">IMPORT DATA</button>
    </div>
</div>

<script>
    const firebaseConfig = { apiKey: "AIzaSyBEod8zm1jvvkmPbe6cA_SQo2U_esC9yTY", databaseURL: "https://aangiftebotje-default-rtdb.europe-west1.firebasedatabase.app", projectId: "aangiftebotje" };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let dynamicWords = [], vnaam, sRef, score = 0, levens = 5, frame = 0, inGame = false, quizCount = 0, quizTarget = 5;
    let canvas, ctx, tileSize, pacman = { x: 10, y: 14, dir: {x:0, y:0}, nextDir: {x:0, y:0}, rotation: 0 };
    let dots = [], walls = [], ghosts = [], powerTimer = 0;

    const mazeLayout = [
        [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
        [1,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,1],
        [1,3,1,1,1,0,1,1,1,0,1,0,1,1,1,0,1,1,1,3,1],
        [1,0,1,1,1,0,1,1,1,0,1,0,1,1,1,0,1,1,1,0,1],
        [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
        [1,0,1,1,1,0,1,0,1,1,1,1,1,0,1,0,1,1,1,0,1],
        [1,0,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,0,1],
        [1,1,1,1,1,0,1,1,1,0,1,0,1,1,1,0,1,1,1,1,1],
        [1,1,1,1,1,0,1,0,0,0,0,0,0,0,1,0,1,1,1,1,1],
        [0,0,0,0,0,0,1,0,1,1,2,1,1,0,1,0,0,0,0,0,0], // Tunnel
        [1,1,1,1,1,0,1,0,1,2
